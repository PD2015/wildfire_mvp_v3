#!/bin/sh
# Pre-commit hook to auto-format and analyze Dart code
# This ensures all commits have properly formatted code and no lint errors
#
# Setup: git config core.hooksPath .githooks
# Bypass: git commit --no-verify (not recommended)

echo "üîç Running dart format..."

# Format all Dart files
dart format .

# Add any formatted files back to the staging area
git add -u

echo "‚úÖ Code formatting complete"
echo ""
echo "üîç Running flutter analyze..."

# Run static analysis (only if Flutter is available)
if command -v flutter >/dev/null 2>&1; then
  flutter analyze --no-fatal-infos
  ANALYZE_EXIT=$?
  
  if [ $ANALYZE_EXIT -ne 0 ]; then
    echo ""
    echo "‚ùå Flutter analyze found issues!"
    echo "   Please fix the issues above before committing."
    echo "   Or use 'git commit --no-verify' to bypass (not recommended)."
    exit 1
  fi
  
  echo "‚úÖ Static analysis passed"
else
  echo "‚ö†Ô∏è  Flutter not found in PATH, skipping analyze (CI will catch issues)"
fi

exit 0
