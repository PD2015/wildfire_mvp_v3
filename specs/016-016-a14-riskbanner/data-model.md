# Data Model: RiskBanner Visual Refresh

**Feature**: RiskBanner Visual Refresh  
**Date**: 2025-11-02  
**Status**: Phase 1 Design

## Entity Analysis

### RiskBannerConfig (New)
**Purpose**: Configuration object for RiskBanner widget feature toggles and display options

**Fields**:
- `showWeatherPanel: bool` - Controls weather panel visibility (default: false)

**Validation Rules**:
- Non-nullable boolean value
- Default constructor sets showWeatherPanel to false

**State Transitions**: N/A (immutable configuration object)

**Relationships**: 
- Used by RiskBanner widget as optional parameter
- Independent of FireRisk data model

### FireRisk (Preserved - No Changes)
**Purpose**: Core fire risk data model (unchanged in this feature)

**Fields** (existing, preserved):
- Risk level, FWI value, data source, timestamp, location, freshness

**Validation Rules** (existing, preserved):
- All existing validation maintained

**Note**: This feature explicitly does NOT modify the FireRisk model per FR-015

### Location Display (UI State)
**Purpose**: Formatted coordinate string for display in banner

**Fields**:
- `locationLabel: String?` - Optional formatted coordinates (e.g., "(55.95, -3.19)")

**Validation Rules**:
- Nullable string (banner displays without location row if null)
- Format: parentheses with lat/lon to 2 decimal places
- Generated by parent widget (HomeScreen) from existing location data

**Relationships**:
- Derived from existing location services
- Passed to RiskBanner as display parameter

## UI State Model

### RiskBanner Widget State
**Current Parameters** (preserved):
- `fireRisk: FireRisk` - Core risk data
- `onRetry: VoidCallback?` - Error state retry handler

**New Parameters**:
- `locationLabel: String?` - Formatted coordinates for display
- `config: RiskBannerConfig?` - Feature configuration (defaults to disabled weather panel)

**Visual State Mapping**:
```
FireRisk.freshness -> Display Elements:
- live/stale -> Normal display
- cached -> Normal display + CachedBadge
- error -> Error state with warning icon + onRetry

FireRisk.source -> Data Source Display:
- DataSource.effis -> "Data Source: EFFIS"
- DataSource.sepa -> "Data Source: SEPA" 
- DataSource.cache -> "Data Source: Cache"
- DataSource.mock -> "Data Source: Mock"

config.showWeatherPanel -> Weather Panel:
- true -> Render weather scaffolding
- false/null -> No weather panel
```

## Styling Constants

### Local Widget Constants (New)
```dart
// Banner container styling
const double kBannerRadius = 16.0;
const EdgeInsets kBannerPadding = EdgeInsets.all(16.0);
const double kBannerElevation = 2.0;

// Weather panel styling (when enabled)
const double kWeatherPanelRadius = 8.0;
const EdgeInsets kWeatherPanelPadding = EdgeInsets.all(8.0);
```

### Preserved Dependencies
- `RiskPalette` color mapping (unchanged)
- `_getRiskLevelColor()` method (unchanged)  
- `_getTextColor()` luminance computation (unchanged)

## Data Flow

### Input Sources
1. **FireRisk** → From existing services (unchanged flow)
2. **LocationLabel** → From HomeScreen coordinate formatting
3. **RiskBannerConfig** → From parent widget or default constructor

### Processing
1. **Risk Level Display** → Map FireRisk.level to color via existing RiskPalette
2. **Location Display** → Conditional render based on locationLabel presence
3. **Timestamp Display** → Format FireRisk.timestamp for internal banner display
4. **Source Display** → Map FireRisk.source to human-readable text
5. **Weather Panel** → Conditional render based on config.showWeatherPanel

### Output
- Enhanced visual banner with all information consolidated internally
- Preserved accessibility semantics
- Consistent styling across all risk levels and states

## Migration Impact

### Breaking Changes: None
- All existing RiskBanner constructor calls remain valid
- New parameters are optional with sensible defaults
- FireRisk model unchanged

### Behavioral Changes
- Timestamp moves from external HomeScreen row to internal banner display
- Data source changes from chip widget to plain text
- External source chip usage in HomeScreen can be removed

### Test Impact
- Existing unit tests for risk level logic: **Preserved**
- Widget tests expecting external timestamp: **Require updates**
- Widget tests expecting source chip: **Require updates**
- New golden tests: **Added**